<html>
<head>
  <meta charset="UTF-8">
  <title>Pivotal Stats</title>
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.2/normalize.min.css">
  <link rel="stylesheet" type="text/css" href="/css/app.css">
  <!-- JS -->
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.js"></script>
  <script src="http://code.highcharts.com/highcharts.js"></script>
  <script src="http://code.highcharts.com/modules/exporting.js"></script>
</head>
<body>

  <div class="wrapper">
    <div class="users"></div>
  </div>

  <script src="/javascript/helpers.js"></script>
  <script type="text/javascript">

    var getProjectData = function(id, cb) {
      $.ajax({
        url: 'http://localhost:8999/api/project/'+ id,
        type: 'GET',
        dataType: 'json'
      }).done(function(res) {
        var obj = res.data;
        cb(obj);
      });
    };

    $(function() {
      var fullUrl = document.URL;
      var urlArray = fullUrl.split('/');
      var projectID = urlArray[urlArray.length-1];
      console.log( projectID );

      getProjectData(projectID, function(data) {

        getTemplate('projects-template.handlebars', function(source) {
          var template = Handlebars.compile(source);
          var html     = template([data]);
          $('.wrapper').prepend(html);

          getGraph(data, 'backlog');
          getGraph(data, 'current');
          getGraph(data, 'done');
        });

      });

      getUserStats(projectID, function(data) {
        createUserStats(data);
      });
    });
  </script>

</body>
</html>
